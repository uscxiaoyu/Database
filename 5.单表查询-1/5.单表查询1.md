# 数据查询：单表查询-基本语法
```sql
use purchase;
```

## 一、基本语法

### 1. `SELECT`子句定义查询返回的字段
列出特定字段名对应数据（即进行字段的筛选）的语法格式如下:

```sql
SELECT 字段名1, 字段名2, ..., 字段名n
FROM 表名;
```

#### 示例1: 通过列出所有字段名查询product表的数据

```sql
SELECT product_id, product_name, product_code, product_place, product_date, price, unit, detail, subsort_id, sort_id
FROM product;
```

#### 示例2：通过*查询product表的所有数据

```sql
SELECT *
FROM product;
```

> 注意: 查询结果字段排序为`DESC 表名`中的字段排序。

#### 示例3：查询指定字段对应的数据

```sql
SELECT product_id, product_name, price
FROM product;
```

### 2. `LIMIT`子句限定查询返回的行数

当不需要显示所有查询结果时，可以通过LIMIT限定查询的个数, 语法格式为：

```sql
SELECT *|{字段名1,字段名2,……}
FROM 表名
WHERE 子句
LIMIT m [,n];
```

> 参数m为偏移量（即第一个返回的记录对应的序号），n为返回的个数

#### 课堂示例4: 查询前10个product表中的商品记录
```sql
SELECT *
FROM product
LIMIT 10;
```

### 练习1：
- （1）查询member表中的所有数据，返回前10行
- （2）查询指定字段对应的数据，返回10~19行
```sql
-- 查询member表中的所有数据, 返回前10行

SELECT user_name, user_password, true_name, sex, phone, mobile, email, address, attribute
FROM member
LIMIT 10;

SELECT *
FROM member;

-- 查询指定字段对应的数据, 返回10~19行
SELECT user_name, address, email
FROM member;
LIMIT 9, 10;
```
## 二、`WHERE`子句

#### 1. 带关系运算符的查询：对数据筛选过滤
语法格式:

```sql
SELECT 字段名1, 字段名2, ...
FROM 表名
WHERE 条件表达式
LIMIT [m,] n;
```

- 常见的关系运算符号：=、<>、！=、<、<=、>、>=

#### 示例5：查询`product`表中`Product_Place`为“天津”的产品信息

```sql
SELECT *
FROM product
WHERE product_place = '天津';
```

#### 示例6：使用`SELECT`语句查询Product_Name为“京瓷KM-4030复印机”的商品价格

```sql
SELECT price
FROM product
WHERE product_name = '京瓷KM-4030复印机';
```

#### 示例7：查询Product表中Price 大于1000的商品代码和名称

```sql
SELECT product_id, product_name
FROM product
WHERE price >= 1000;
```

> 注意: 在SQL中，a <= x <= b并不等价于 x >= a and x <= b<br>请比较以下两个查询结果:

```sql
SELECT COUNT(product_id)
FROM product
WHERE 100 <= price <= 500;

SELECT COUNT(product_id)
FROM product
WHERE price >= 100 AND price <= 500;
```

> 注：（1）`count(*)`可用于统计返回结果的行数；
> （2）`100 <= price <= 500`返回表中的记录数, 先运算`100 <= price`，再将运算结果(`true或false`)与`500`进行比较，显然对于每一行有price值且大于等于0的行都成立.

### 2. 带in关键字的查询：限定结果在某一集合中

语法格式

```sql
SELECT *|字段名1,字段名2,……
FROM 表名
WHERE 字段名 [NOT] IN (元素1,元素2,……)
```

#### 示例8：查找product表中产地为天津、北京和日本的商品的全部信息

```sql
SELECT *
FROM product
WHERE product_place IN ('天津', '北京', '日本');
```

- 补充：查找product表中产地不为天津，北京和日本的商品的全部行

```sql
SELECT *
FROM product
WHERE product_place NOT IN ('天津', '北京', '日本');
```

### 3. 带`BETWEEN ... AND`关键字的查询：限定结果在指定范围

语法格式

```sql
SELECT *|{字段名1,字段名2,……}
FROM 表名 WHERE 字段名 [NOT] BETWEEN 值1 AND 值2;
```

#### 示例9：查询prodct表中Price值在200和500之间的商品信息

```sql
SELECT *
FROM product
WHERE price BETWEEN 200 AND 500;

-- 或者
SELECT *
FROM product
WHERE price >= 200 AND price <= 500;
```

#### 示例10：查询product表中Price值不在200和500之间的商品信息

```sql
SELECT *
FROM product
WHERE price NOT BETWEEN 200 AND 500;

-- 或者
SELECT *
FROM product
WHERE price < 200 OR price > 500;
```

#### 4. 空值查询：判断某些列值是否为`NULL`

语法结构：

```sql
SELECT *|字段名1,字段名2,……
FROM 表名
WHERE 字段名 IS [NOT] NULL;
```

#### 示例11：查询product表中Product_Place为空值的商品名称和价格

```sql
SELECT product_name, price
FROM product
WHERE product_place IS NULL;
```

#### 示例12：查询product表中Product_Place不为空值的记录

```sql
SELECT product_name, price
FROM product
WHERE product_place IS NOT NULL;
```

### 5. 字段前带DISTINCT关键字的查询：剔除查询结果中的重复行

语法格式

```sql
SELECT DISTINCT 字段名
FROM 表名
[WHERE 条件表达式];
```

#### 示例13：查询product表中Product_Place字段的值，查询记录不能重复

```sql
SELECT DISTINCT product_place
FROM product;
```

- DISTINCT关键字作用于多个字段：向量比较，只有DISTINCT关键字后指定的多个字段值都相同，才会被认作是重复记录。

#### 示例14：找出product表中不同的根类别和子类别的组合

```sql
SELECT DISTINCT sort_id, subsort_id
FROM product;
```

## 三、匹配字符串

### 1. 带LIKE关键字的字符串简单匹配

- 语法格式
  
```sql
SELECT *|{字段名1,字段名2,……}
FROM 表名
WHERE 字段名 [NOT] LIKE '匹配字符串';
```

> LIKE语法格式中的“匹配字符串”指定用来匹配的字符串，其值可以是一个普通字符串，也可以是包含百分号(%)和下划线(\_)等通配字符串: <br>(1) %: 可以匹配任意长度的字符串，包括空字符串; <br>(2) \_: 下划线通配符只匹配单个字符，如果要匹配多个字符，需要使用多个下划线通配符

#### 示例15：查找product表中商品名称含有复印机的商品名称，价格和产地

```sql
SELECT product_name, price, product_place
FROM product
WHERE product_name LIKE '%复印机%';

SELECT product_id, product_name, price, product_place
FROM product
WHERE product_name LIKE '______复印机';
```

> 注意：百分号和下划线是通配符，它们在通配字符串中有特殊含义，因此，如果要匹配字符串中的百分号和下划线，就需要在通配字符串中使用右斜线(“\”)对百分号和下划线进行转义，例如，“\%”匹配百分号字面值，“\_”匹配下划线字面值。

#### 示例16: 找出product表商品名称含有“\_”的记录

```sql
-- 插入示例行数据
INSERT INTO product(product_id, product_name)
VALUES ('33', '理光_复印机'),
	('44', '理光%复印机');

SET sql_safe_updates = 0; -- 若在workbench中，请先关闭安全更新模式

DELETE FROM product
WHERE product_id = 44;

SELECT *
FROM product
WHERE product_name LIKE '%\%%';
```

### 2. 利用正则表达式匹配字符串: `regexp`

| 模式    | 描述 |
|------: |------: |
|`^` |匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 '\n' 或 '\r' 之后的位置。|
|`$` |匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 '\n' 或 '\r' 之前的位置。|
|`.`	|匹配除 "\n" 之外的任何单个字符。要匹配包括 '\n' 在内的任何字符，请使用象 '[.\n]' 的模式。|
|`[...]` | 字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 "plain" 中的 'a'。|
|`[^...]` |负值字符集合。匹配未包含的任意字符。例如， '[^abc]' 可以匹配 "plain" 中的'p'。
| `p1 |p2 |p3` |匹配 p1 或 p2 或 p3。例如，`'z|food'` 能匹配 "z" 或 "food"。`'(z|f)ood'` 则匹配 "zood" 或 "food"。|
|`*` |匹配前面的子表达式零次或多次。例如，zo* 能匹配 "z" 以及 "zoo"。* 等价于{0,}。|
|`+` |匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 "zo" 以及 "zoo"，但不能匹配 "z"。+ 等价于 {1,}。|
|`{n}` |n 是一个非负整数。匹配确定的 n 次。例如，'o{2}' 不能匹配 "Bob" 中的 'o'，但是能匹配 "food" 中的两个 o。|
|`{n,m}` |m 和 n 均为非负整数，其中n <= m。最少匹配 n 次且最多匹配 m 次。|

#### 示例17: 查找product表中product_name末尾字符串为有复印机的商品名称，价格和产地

```sql
SELECT product_name, price, product_place
FROM product
WHERE product_name REGEXP '复印机$';
```

#### 示例: 查询product表中product_place在江苏的product_name, price和product_place

```sql
SELECT *
FROM product
WHERE product_place REGEXP '^江苏';
```

## 四、复合查询

### 1. 带`AND`关键字的多条件查询: 连接两个或者多个查询条件
`AND`等价于`&&`
- 语法格式

```sql
SELECT *|{字段名1,字段名2,……}
FROM 表名
WHERE 条件表达式1 […… AND 条件表达式n];
```

#### 示例18：找出商品名称含复印机且产地在天津的记录

```sql
SELECT *
FROM product
WHERE product_place = '天津' AND product_name LIKE '%复印机%';

-- 或则
SELECT *
FROM product
WHERE product_place = '天津' AND product_name REGEXP '复印机';

```

#### 2. 带`OR`关键字的多条件查询: 匹配其中的一个条件
`OR` 等价于 `||`
- 语法格式

```sql
SELECT *|{字段名1,字段名2,……}
FROM 表名
WHERE 条件表达式1 […… OR 条件表达式n];
```

#### 示例19：找出`product`中商品名称含'复印机'或'过胶机'的商品记录

```sql
-- 错误写法，注意复合表达式的写法
SELECT *
FROM product
WHERE product_name LIKE '%复印机%';

SELECT *
FROM product
WHERE '%过胶机%';

SELECT count(*)
FROM product
WHERE product_name LIKE '%复印机%' OR '%过胶机%';
```

- 正确写法

```SQL
SELECT *
FROM product
WHERE product_name LIKE '%复印机%' OR product_name LIKE '%过胶机%';

-- 或者
SELECT *
FROM product
WHERE (product_name LIKE '%复印机%') OR (product_name LIKE '%过胶机%');

-- 或者
SELECT *
FROM product
WHERE product_name REGEXP '复印机|过胶机';
```

```sql
-- 找出product中商品类别为复印机的商品记录
SELECT a.product_id, a.product_name, a.price, a.subsort_id, a.sort_id
FROM product a, subsort b
WHERE a.subsort_id = b.subsort_id AND b.subsort_name = '复印机';
```

- `OR`和`AND`关键字一起使用的情况: `AND`的优先级高于`OR`，因此当两者在一起使用时，应该先运算`AND`两边的条件表达式，再运算`OR`两边的条件表达式。

#### 示例20: 找出商品名称含'复印机'和'过胶机'，且产地为天津的的商品记录

```sql
SELECT *
FROM product
WHERE product_name LIKE '%复印机%' AND product_place = '天津'
	OR product_name LIKE '%过胶机%' AND product_place = '天津';
-- 等价于
SELECT *
FROM product
WHERE (product_name LIKE '%复印机%' OR product_name LIKE '%过胶机%') AND product_place = '天津';

-- 等级于
SELECT *
FROM product
WHERE product_name REGEXP '复印机|过胶机' AND product_place = '天津';

-- 不等价于(找出产地为天津且商品名称含过胶机，以及所有商品名称含复印机的商品记录)
SELECT *
FROM product
WHERE product_name LIKE '%复印机%' OR product_name LIKE '%过胶机%' AND product_place = '天津';

```

## 五、文件操作

### 1. 将查询结论写入外部文件

- 准备工作：找到`'C:\ProgramData\MySQL\MySQL Server 5.7\my.ini'` 文件, 将其中的变量`secure-file-priv`的值设置为空"", 设置好之后重启mysql服务，即可将数据存储到任意文件夹下或从任意文件夹中导入数据。

```sql
SELECT 字段1, 字段2, ... | *
FROM 表名 
WHERE 条件表达式
INTO OUTFILE "文件路径+文件名+扩展名" CHARACTER SET 字符集
FILEDS TERMINATED BY 字段值分割符 
OPTIONALLY ENCLOSED BY 字符串标识符 
LINES TERMINATED BY 换行符;
```

#### 示例21: 将`product`表的查询结果导出到文件
```SQL
SELECT product_id, product_name, product_place, price, sort_id
FROM product
WHERE price > 100
INTO OUTFILE 'E:\1.xls' CHARACTER SET gbk
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n';
```

### 2.将外部文件写入到mysql表中

- 准备工作：文本文件，例如`E:\1.csv`

- 语法格式
```sql
LOAD DATA INFILE "文件路径+文件名+扩展名"
INTO TABLE 表名 CHARACTER SET 字符集
FILEDS TERMINATED BY 字段值分割符
OPTIONALLY ENCLOSED BY 字符串标识符
LINES TERMINATED BY 换行符;
```

#### 示例22： 写入数据文件
```sql
CREATE TABLE product_bak AS SELECT * FROM product WHERE 1=2;
SHOW CREATE TABLE product_bak;

LOAD DATA INFILE "E:\1.CSV"
INTO TABLE product_bak CHARACTER SET gbk
FILEDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n';
```

### 练习2

根据`product`表中的数据完成以下查询：

1. 找出零售价在500元到1000元的商品记录，显示`Product_ID, Product_Name, Price, Product_Place, SubSort_ID`和`Sort_ID`
2. 找出商品名称中含有“理光”和“墨粉”的商品记录（理光公司的墨粉产品）
3. 找出`Product_Place`不为空的计算器商品记录，显示10条记录
4. 找出`Product_Place`的不同值
5. 找出 **价格在1000元以下的商品名称中含书柜** 和 **价格在1000元到2000元之间的商品名称含保险柜** 的商品记录

```sql
-- (1) 找出零售价在500元到1000元的商品记录，显示Product_ID, Product_Name, Price, Product_Place, SubSort_ID
SELECT product_id, product_name, price, product_place, subsort_id
FROM product
WHERE price BETWEEN 500 AND 1000;
-- 或者
SELECT product_id, product_name, price, product_place, subsort_id
FROM product
WHERE price >= 500 AND price <= 1000;
-- 或者
SELECT product_id, product_name, price, product_place, subsort_id
FROM product
WHERE NOT (price < 500 OR price > 1000);

-- (2) 找出商品名称含“理光”和“墨粉”的商品记录。（理光公司的墨粉产品）
SELECT *
FROM product
WHERE product_name LIKE '%理光%' AND product_name LIKE '%墨粉%';

-- 或者
SELECT *
FROM product
WHERE product_name LIKE '%理光%墨粉%' OR product_name LIKE '%墨粉%理光%';


-- (3) 找出Product_Place不为空的计算器商品记录，显示10条记录
SELECT *
FROM product
WHERE product_place IS NOT NULL
LIMIT 10;

-- (4) 找出Product_Place的不同值
SELECT DISTINCT product_place
FROM product;

-- (5) 找出 价格在1000元以下的商品名称中含书柜 和 价格在1000元到2000元之间的商品名称含保险柜 的商品记录
SELECT *
FROM product
WHERE (price <= 1000 AND product_name LIKE '%书柜%')
	OR (price BETWEEN 1000 AND 2000 AND product_name LIKE '%保险柜%');

-- 或者
SELECT *
FROM product
WHERE price <= 1000 AND product_name LIKE '%书柜%'
UNION
SELECT *
FROM product
WHERE price BETWEEN 1000 AND 2000 AND product_name LIKE '%保险柜%';
```
