# 大作业(一) 参考答案

## 一、数据定义(30分)

假设有以下关系模式集:

- 学生: student(<u>s_id</u>, s_name, gender, spe_id, birthday);
- 课程: course(<u>c_id</u>, c_name, dept_id, credit, hours);
- 专业: specialty(<u>spe_id</u>, spe_name, dept_id)
- 教师: teacher(<u>t_id</u>, t_name, dept_id, salary);
- 部门: department(<u>dept_id</u>, dept_name, fund, building, description);
- 选课: stu_course(<u>s_id, c_id, t_id</u>, score);

另外，请注意:

> - 下划线字段为主键
> - 表之间有以下参照关系:
> 1)`student`表中的`spe_id`参照`specialty`表中的`spe_id`;
> 2)`course`表中的`dept_id`参照`department`表中的`dept_id`; 
> 3)`specialty`表中的`dept_id`参照`department`表中的`dept_id`;
> 4)`teacher`表中的`dept_id`参照`department`表中的`dept_id`;
> 5)`stu_course`表中的`s_id`参照`student`表中的`s_id`,`c_id`参照`course`表中的`c_id`, `t_id`参照`teacher`表中的`t_id`。

请在`MySQL`数据库管理系统中完成以下操作:

- (1) 创建`college`数据库。(2分)

```sql
DROP DATABASE college;
CREATE DATABASE college;
```

- (2) 在该`college`中创建以上6个表，数据类型和长度自定。(16分)
>注意: 各表之间有以下参照关系:
    - student表中的spe_id参照speciality表中的spe_id;
    - course表中的dept_id参照department表中的dept_id; 
    - specialty表中的dept_id参照department表中的dept_id; 
    - teacher表中的dept_id参照department表中的dept_id; 
    - stu_course表中的s_id参照student表中的s_id, c_id参照course表中的c_id, t_id参照teacher表中的t_id。
```sql
USE college;

CREATE TABLE department (
    dept_id INT(8) PRIMARY KEY,
    dept_name VARCHAR(20) NOT NULL,
    fund DECIMAL(10 , 2 ),
    building VARCHAR(30),
    description VARCHAR(200)
);

CREATE TABLE specialty (
    spe_id INT(8) PRIMARY KEY,
    spe_name VARCHAR(20) NOT NULL,
    dept_id INT(8),
    CONSTRAINT spe_dept FOREIGN KEY (dept_id)
        REFERENCES department (dept_id)
);
                       

CREATE TABLE student (
    s_id INT(8) PRIMARY KEY,
    s_name VARCHAR(8) NOT NULL,
    gender CHAR(1),
    spe_id INT(8),
    birthday DATE,
    CONSTRAINT stu_spe FOREIGN KEY (spe_id)
        REFERENCES specialty (spe_id)
);

CREATE TABLE course (
    c_id INT(10) PRIMARY KEY,
    c_name VARCHAR(20) NOT NULL,
    dept_id INT(8),
    credit DECIMAL(2 , 1 ),
    hours INT(3),
    CONSTRAINT course_dept FOREIGN KEY (dept_id)
        REFERENCES department (dept_id)
);

CREATE TABLE teacher (
    t_id INT(8) PRIMARY KEY,
    t_name VARCHAR(20) NOT NULL,
    dept_id INT(8),
    salray DECIMAL(7 , 2 ),
    CONSTRAINT tea_dept FOREIGN KEY (dept_id)
        REFERENCES department (dept_id)
);

CREATE TABLE stu_course (
    s_id INT(8),
    c_id INT(10),
    t_id INT(8),
    score DECIMAL(4 , 1 ),
    PRIMARY KEY (s_id , c_id , t_id),
    CONSTRAINT sc_stu FOREIGN KEY (s_id)
        REFERENCES student (s_id),
    CONSTRAINT sc_course FOREIGN KEY (c_id)
        REFERENCES course (c_id),
    CONSTRAINT sc_tea FOREIGN KEY (t_id)
        REFERENCES teacher (t_id)
);
```

- (3) 在`teacher`表中新增一个字段`job`表示`teacher`的职位。(4分)

```sql                       
ALTER TABLE teacher ADD job CHAR(10);
```

- (4) 删除`department`表中的`description`字段。(4分)

```sql
ALTER TABLE department DROP description;
```

- (5) 在`student`表中的`spe_id`上构建普通索引。(4分)

```sql
ALTER TABLE student ADD INDEX idx_sid(spe_id);
```

## 二、数据操纵（24分）

在完成数据定义的基础上，继续在`college`数据库中进行以下操作:

- (1) 分别在下表中插入以下记录(12分)

`student`表

| s_id   | s_name   | gender   | spe_id   | birthday |
|----:|----:|----:|----:|----:| ----:|
| 20180201 | 黄庆 | 男 |  101  |  2000-10-1 |
| 20180210 | 张熊 | 男 |  101  |  2000-9-10 |
| 20180234 | 廖玲 | 女 |  101  |  2000-11-1 |
| 20180235 | 韩勇 | 男 |  201  |  1999-4-1 |

`specialty`表

| spe_id   | spe_name   | dept_id |
|----: |----: |----:|
| 101 | 管理信息系统| 001 |
| 102 | 电子商务| 001 |
| 201 | 商务新闻| 002 |

`department`表

| dept_id   | dept_name   | fund |  building |
|----: |----: |----:|----:|
| 001 | 管理学院| 500000 | IS001|
| 002 | 人文学院| 100000 | IS002|

```sql
INSERT INTO department(dept_id, dept_name, fund, building)
VALUES ('001', "管理学院", 500000, "IS001"),
("002", "人文学院", 100000, "IS002");

INSERT INTO specialty(spe_id, spe_name, dept_id)
VALUES ("101", "管理信息系统", "001"),
("102", "电子商务", "001"),
("201", "商务新闻", "002");

INSERT INTO student(s_id, s_name, gender, spe_id, birthday)
VALUES ("20180201", "黄庆", "男", "101", "2000-10-1"),
("20180210", "张熊", "男", "101", "2000-9-10"),
("20180234", "廖玲", "女", "101", "2000-11-1"),
("20180235", "韩勇", "男", "201", "1999-4-1");
```

- (2) 更新`department`表的`'人文学院'`的`fund`：在原来的`fund`值的基础上再增加`10000`。(4分)

```sql
SELECT * 
FROM department 
WHERE dept_name = "人文学院";

UPDATE department
SET fund = fund + 100000
WHERE dept_name = "人文学院";
```

- (3) 删除`department`表中的`'人文学院'`记录行。(8分)

```sql
SELECT * 
FROM department NATURAL JOIN specialty NATURAL JOIN student 
WHERE dept_name = "人文学院";

DELETE FROM student
WHERE spe_id = "201";

DELETE FROM specialty
WHERE spe_id = "201";

DELETE FROM department 
WHERE dept_name = "人文学院";
```

## 三、数据查询（46分）

```sql
USE mis;
```

> 导入mis.sql文件，创建数据库mis，观测各数据表的结构和数据，然后完成以下查询任务

- (1) 查询所有获得奖学金的学生的学号、姓名、性别、出生年份、奖学金。(4分)
```sql
SELECT 
    学号, 姓名, 性别, YEAR(生日) 出生年份, 奖学金
FROM
    学生表
WHERE
    奖学金 IS NOT NULL;
-- 或者
SELECT 
    学号, 姓名, 性别, YEAR(生日) 出生年份, 奖学金
FROM
    学生表
WHERE
    奖学金 > 0;
```
- (2) 查询所有获得一等奖学金的学生记录，按出生月份升序排序。(4分)
```sql
SELECT 
    *
FROM
    学生表
WHERE
    备注 LIKE '%一等%'
ORDER BY MONTH(生日);
-- 或者
SELECT 
    *
FROM
    学生表
WHERE
    备注 LIKE '%一等奖%'
ORDER BY MONTH(生日);
```
- (3) 查询各专业的奖学金总额，**剔除**未获取奖学金的专业，返回专业编号和奖学金总额，并按奖学金总额降序排序。(8分)
```sql
SELECT 
    专业, SUM(奖学金) 奖学金总额
FROM
    学生表
GROUP BY 专业
HAVING SUM(奖学金) IS NOT NULL
ORDER BY SUM(奖学金);
-- 或者
SELECT 
    专业, SUM(奖学金) 奖学金总额
FROM
    学生表
GROUP BY 专业
HAVING SUM(奖学金) > 0
ORDER BY SUM(奖学金);
-- 或者
SELECT 
    专业, SUM(奖学金) 奖学金总额
FROM
    学生表
WHERE
    奖学金 IS NOT NULL
GROUP BY 专业
ORDER BY SUM(奖学金);
```
- (4) 查询学生表中专业编号为`'01'`的姓王或姓李的学生记录, **要求显示学号、姓名、性别和奖学金字段。**(4分)
```sql
SELECT 
    学号, 姓名, 性别, 奖学金
FROM
    学生表
WHERE
    专业 = '01' AND 姓名 LIKE '王%'
        OR 专业 = '01' AND 姓名 LIKE '李%';
-- 或者
SELECT 
    学号, 姓名, 性别, 奖学金
FROM
    学生表
WHERE
    专业 = '01'
        AND (姓名 LIKE '王%' OR 姓名 LIKE '李%');
```

- (5) 查询学生表中各专业的奖学金平均值（别名为 奖学金均值）和各专业人数（别名为 人数），**要求显示奖学金总额在2000元以上的专业名称和奖学金均值及各专业人数。**(8分)
```sql
SELECT 
    专业, AVG(奖学金) 奖学金均值, COUNT(学号) 人数
FROM
    学生表
GROUP BY 专业
HAVING SUM(奖学金) > 2000;
```
- (6) 查询`'02'、'04'、'09'`和`'15'`等专业中的05级学生记录，显示第4条记录到第8条记录。(4分)
```sql
SELECT 
    *
FROM
    学生表
WHERE
    专业 IN ('02' , '04', '09', '15')
        AND 学号 LIKE '05%'
LIMIT 3, 5;
```
- (7) 查询各位学生的平均分，返回学号、学生姓名和平均成绩，按平均分从高到低排序，返回前10个记录。(7分)
```sql
SELECT 
    学生表.学号, 姓名, AVG(成绩表.成绩) 平均成绩
FROM
    学生表
        JOIN
    成绩表 ON 学生表.学号 = 成绩表.学号
GROUP BY 学生表.学号
ORDER BY 平均成绩 DESC
LIMIT 10;
```
- (8) 查询各门课程的不及格人数，返回课程号、课程名称和不及格人数，按不及格人数从高到低排序，返回前10个记录。(7分)

```sql
SELECT 
    课程表.课程号,
    课程表.课程名称,
    COUNT(成绩表.学号) 不及格人数
FROM
    课程表
        JOIN
    成绩表 ON 课程表.课程号 = 成绩表.课程号
WHERE
    成绩 < 60
GROUP BY 课程表.课程号
ORDER BY 不及格人数 DESC
LIMIT 10;
```